{% extends "base.html" %}

{% block title %}å•†å“ä¸€è¦§ - ç‰©è²©ç®¡ç†ãƒ„ãƒ¼ãƒ«{% endblock %}

{% block content %}
<div class="dashboard">
    <!-- çµ±è¨ˆã‚«ãƒ¼ãƒ‰ -->
    <div class="stats-grid">
        <div class="stat-card">
            <span class="stat-icon">â—ˆ</span>
            <div class="stat-info">
                <span class="stat-label">ç·å•†å“æ•°</span>
                <span class="stat-value">{{ stats.total }}</span>
            </div>
        </div>
        <div class="stat-card">
            <span class="stat-icon">â—‡</span>
            <div class="stat-info">
                <span class="stat-label">å‡ºå“ä¸­</span>
                <span class="stat-value">{{ stats.listed }}</span>
            </div>
        </div>
        <div class="stat-card">
            <span class="stat-icon">â—†</span>
            <div class="stat-info">
                <span class="stat-label">å£²å´æ¸ˆ</span>
                <span class="stat-value">{{ stats.sold }}</span>
            </div>
        </div>
        <div class="stat-card stat-card-profit">
            <span class="stat-icon">â˜…</span>
            <div class="stat-info">
                <span class="stat-label">ç·åˆ©ç›Š</span>
                <span class="stat-value">Â¥{{ "{:,.0f}".format(stats.total_profit) }}</span>
            </div>
        </div>
    </div>
    
    <!-- æ¤œç´¢ãƒ»ãƒ•ã‚£ãƒ«ã‚¿ãƒ¼ -->
    <div class="filter-section">
        <form action="{{ url_for('index') }}" method="get" class="search-form">
            <input type="text" name="search" value="{{ search }}" placeholder="å•†å“åãƒ»åº—èˆ—åã§æ¤œç´¢..." class="search-input">
            <button type="submit" class="btn btn-search">æ¤œç´¢</button>
        </form>
        
        <div class="filter-buttons">
            <a href="{{ url_for('index', filter='all') }}" class="filter-btn {% if filter_type == 'all' %}active{% endif %}">å…¨ã¦</a>
            <a href="{{ url_for('index', filter='today') }}" class="filter-btn {% if filter_type == 'today' %}active{% endif %}">ä»Šæ—¥</a>
            <a href="{{ url_for('index', filter='yesterday') }}" class="filter-btn {% if filter_type == 'yesterday' %}active{% endif %}">æ˜¨æ—¥</a>
            <a href="{{ url_for('index', filter='this_week') }}" class="filter-btn {% if filter_type == 'this_week' %}active{% endif %}">ä»Šé€±</a>
            <a href="{{ url_for('index', filter='this_month') }}" class="filter-btn {% if filter_type == 'this_month' %}active{% endif %}">ä»Šæœˆ</a>
            <a href="{{ url_for('index', filter='not_listed') }}" class="filter-btn {% if filter_type == 'not_listed' %}active{% endif %}">æœªå‡ºå“</a>
            <a href="{{ url_for('index', filter='listed') }}" class="filter-btn {% if filter_type == 'listed' %}active{% endif %}">å‡ºå“ä¸­</a>
            <a href="{{ url_for('index', filter='sold') }}" class="filter-btn {% if filter_type == 'sold' %}active{% endif %}">å£²å´æ¸ˆ</a>
        </div>
        
        <div class="action-buttons">
            <a href="{{ url_for('add_item') }}" class="btn btn-primary">+ å•†å“ç™»éŒ²</a>
            <a href="{{ url_for('export_csv') }}" class="btn btn-gold">ğŸ“Š CSVå‡ºåŠ›</a>
        </div>
    </div>
    
    <!-- å•†å“ãƒªã‚¹ãƒˆ -->
    <div class="items-list">
        {% if items %}
            {% for item in items %}
                <div class="item-card" onclick="location.href='{{ url_for('view_item', id=item.id) }}'">
                    <div class="item-photo">
                        {% if item.photo_path %}
                            <img src="{{ url_for('static', filename=item.photo_path.replace('static/', '')) }}" alt="{{ item.product_name }}">
                        {% else %}
                            <div class="no-photo">â—‡</div>
                        {% endif %}
                    </div>
                    <div class="item-info">
                        <div class="item-header">
                            <span class="item-id">No.{{ item.id }}</span>
                            <div class="item-badges">
                                {% if item.is_listed %}
                                    <span class="badge badge-listed">å‡ºå“æ¸ˆ</span>
                                {% endif %}
                                {% if item.sold_date %}
                                    <span class="badge badge-sold">å£²å´æ¸ˆ</span>
                                {% endif %}
                                {% if item.is_shipped %}
                                    <span class="badge badge-shipped">ç™ºé€æ¸ˆ</span>
                                {% endif %}
                            </div>
                        </div>
                        <h3 class="item-name">{{ item.product_name }}</h3>
                        <p class="item-store">{{ item.store_name or '---' }}</p>
                        <div class="item-prices">
                            <div class="price-row">
                                <span class="price-label">ä»•å…¥</span>
                                <span class="price-value">Â¥{{ "{:,.0f}".format(item.purchase_price or 0) }}</span>
                            </div>
                            {% if item.sale_price %}
                            <div class="price-row">
                                <span class="price-label">å£²ä¸Š</span>
                                <span class="price-value">Â¥{{ "{:,.0f}".format(item.sale_price) }}</span>
                            </div>
                            {% endif %}
                        </div>
                        {% set profit = calculate_profit(item) %}
                        {% if item.sold_date %}
                        <div class="item-profit {% if profit >= 0 %}profit-positive{% else %}profit-negative{% endif %}">
                            åˆ©ç›Š: Â¥{{ "{:,.0f}".format(profit) }}
                            ({{ "{:.1f}".format(calculate_profit_rate(item)) }}%)
                        </div>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        {% else %}
            <div class="empty-state">
                <span class="empty-icon">ğŸ“¦</span>
                <p>å•†å“ãŒã‚ã‚Šã¾ã›ã‚“</p>
                <a href="{{ url_for('add_item') }}" class="btn btn-primary">æœ€åˆã®å•†å“ã‚’ç™»éŒ²</a>
            </div>
        {% endif %}
    </div>
</div>
{% endblock %}


