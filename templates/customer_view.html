{% extends "base.html" %}

{% block title %}{{ customer.name }} - é¡§å®¢è©³ç´°{% endblock %}

{% block content %}
<div class="view-container">
    <div class="view-header">
        <a href="{{ url_for('customers_list') }}" class="btn btn-secondary">â† é¡§å®¢ä¸€è¦§</a>
        <div class="view-actions">
            <a href="{{ url_for('edit_customer', id=customer.id) }}" class="btn btn-primary">âœ ç·¨é›†</a>
            <form action="{{ url_for('delete_customer', id=customer.id) }}" method="post" class="delete-form" onsubmit="return confirm('ã“ã®é¡§å®¢ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ');">
                <button type="submit" class="btn btn-danger">âœ• å‰Šé™¤</button>
            </form>
        </div>
    </div>
    
    <div class="customer-detail">
        <!-- ãƒ©ãƒ³ã‚¯ã‚«ãƒ¼ãƒ‰ -->
        <div class="rank-display rank-{{ stats.rank }}">
            <div class="rank-icon-large">
                {% if stats.rank == 'platinum' %}ğŸ’
                {% elif stats.rank == 'gold' %}ğŸ¥‡
                {% elif stats.rank == 'silver' %}ğŸ¥ˆ
                {% else %}ğŸ¥‰{% endif %}
            </div>
            <div class="rank-text">
                <span class="rank-label-large">{{ stats.rank_name }}</span>
                <span class="rank-member">ä¼šå“¡</span>
            </div>
        </div>
        
        <!-- é¡§å®¢æƒ…å ± -->
        <div class="view-content">
            <h1 class="customer-name-large">{{ customer.name }}</h1>
            
            <div class="info-section">
                <h3 class="info-section-title">ğŸ“Š è³¼å…¥å®Ÿç¸¾</h3>
                <div class="stats-display">
                    <div class="stat-box">
                        <span class="stat-number">{{ stats.purchase_count }}</span>
                        <span class="stat-label">è³¼å…¥å›æ•°</span>
                    </div>
                    <div class="stat-box stat-box-highlight">
                        <span class="stat-number">Â¥{{ "{:,.0f}".format(stats.total_purchase) }}</span>
                        <span class="stat-label">ç´¯è¨ˆè³¼å…¥é‡‘é¡</span>
                    </div>
                </div>
                
                {% if next_rank_info %}
                <div class="next-rank-info">
                    <p>ğŸ¯ <strong>{{ next_rank_info.rank }}</strong>ã¾ã§ã‚ã¨ <strong>Â¥{{ "{:,.0f}".format(next_rank_info.needed) }}</strong></p>
                    <div class="progress-bar">
                        {% if stats.rank == 'bronze' %}
                            {% set progress = (stats.total_purchase / rank_thresholds.silver) * 100 %}
                        {% elif stats.rank == 'silver' %}
                            {% set progress = ((stats.total_purchase - rank_thresholds.silver) / (rank_thresholds.gold - rank_thresholds.silver)) * 100 %}
                        {% elif stats.rank == 'gold' %}
                            {% set progress = ((stats.total_purchase - rank_thresholds.gold) / (rank_thresholds.platinum - rank_thresholds.gold)) * 100 %}
                        {% else %}
                            {% set progress = 100 %}
                        {% endif %}
                        <div class="progress-fill" style="width: {{ progress }}%"></div>
                    </div>
                </div>
                {% else %}
                <div class="max-rank-info">
                    <p>ğŸ‰ æœ€é«˜ãƒ©ãƒ³ã‚¯ã«åˆ°é”ã—ã¦ã„ã¾ã™ï¼</p>
                </div>
                {% endif %}
            </div>
            
            <div class="info-section">
                <h3 class="info-section-title">ğŸ“‡ é€£çµ¡å…ˆ</h3>
                <div class="info-grid">
                    <div class="info-item">
                        <span class="info-label">ãƒ¡ãƒ¼ãƒ«</span>
                        <span class="info-value">{{ customer.email or '---' }}</span>
                    </div>
                    <div class="info-item">
                        <span class="info-label">é›»è©±ç•ªå·</span>
                        <span class="info-value">{{ customer.phone or '---' }}</span>
                    </div>
                    <div class="info-item" style="grid-column: 1 / -1;">
                        <span class="info-label">ä½æ‰€</span>
                        <span class="info-value">{{ customer.address or '---' }}</span>
                    </div>
                </div>
            </div>
            
            {% if customer.memo %}
            <div class="info-section">
                <h3 class="info-section-title">ğŸ“ ãƒ¡ãƒ¢</h3>
                <p class="memo-text">{{ customer.memo }}</p>
            </div>
            {% endif %}
            
            <!-- è³¼å…¥å±¥æ­´ -->
            <div class="info-section">
                <h3 class="info-section-title">ğŸ›’ è³¼å…¥å±¥æ­´</h3>
                {% if purchases %}
                <div class="purchase-history">
                    {% for item in purchases %}
                    <div class="purchase-item">
                        <div class="purchase-date">{{ item.sold_date }}</div>
                        <div class="purchase-name">{{ item.product_name }}</div>
                        <div class="purchase-price">Â¥{{ "{:,.0f}".format(item.sale_price) }}</div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <p class="no-data">è³¼å…¥å±¥æ­´ãŒã‚ã‚Šã¾ã›ã‚“</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}

